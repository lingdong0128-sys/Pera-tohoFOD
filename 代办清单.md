

权重的定义如下：
*   **P0 (基石)**：如果不做，游戏跑不起来或者会直接报错，是后续系统的地基。
*   **P1 (核心)**：构成最小可玩原型（MVP）的关键功能，做完这些能跑通一个完整的“一天”。
*   **P2 (进阶)**：丰富游戏性、增加自由度和智能化的功能。
*   **P3 (填充)**：剧情、细节润色和非核心机制。

---

### 🔴 P0：核心数据与框架基石 (必须最先完成)

这些是所有功能的“地基”，特别是涉及存档和全局变量的部分。

*   [ ] **1. 全局数据初始化补全**
    *   **异常状态 (Bad Status)**：在 `csv/global/` 下建立 `Abnormal.csv`，并在 `init.py` 读取。在 `state_builder.py` 中为每个角色初始化异常状态字典。
    *   **地牢基础数据**：建立 `DungeonStats.csv`（如进入次数、层数记录），并在 `init.py` 中初始化。
    *   **口上类型数据**：在 `charaters_key` 中补全默认口上类型（如你之前提到的 `1_初期`），防止 `start.py` 调用时报错。

*   **2. 角色属性扩展**
    *   **花销数据 (Cost Data)**：在 `global` 下建立 `ActionCost.csv`，定义各种行为的基础消耗值。
    *   **地牢化数值映射**：在 `state_builder.py` 中增加逻辑，将角色的 `BASE` (体力/气力) 映射为地牢战斗用的 `HP/MP/ATK`，确保进入地牢有数值可用。

*   **3. 基础时间系统**
    *   在 `global_key['System']` 中确立 `DAY` (天数) 和 `TIME` (分钟/小时) 的存储标准。这是所有 AI 和结算的基础。

---

### 🟠 P1：最小可玩循环 (让游戏能“转”起来)

做完这些，玩家可以创建角色，接任务，进地牢，虽然很简陋，但流程是通的。

*   **4. 任务系统 (Task System)**
    *   [ ] **数据结构**：建立 `Task.csv`，定义任务ID、名称、描述、完成条件。
    *   [ ] **存档支持**：在 `allstate` 或 `globals` 中增加 `active_tasks` (已接取) 和 `finished_tasks` (已完成) 列表。
    *   [ ] **UI与判定**：编写 `event_task_menu` (任务栏) 和 `check_task_completion` (判定函数)。

*   **5. 启动流程完善 (Start Flow)**
    *   [ ] **Master 选择**：编写事件，判断存档是否存在主角，不存在则提供选择或新建。
    *   [ ] **难度选择**：读取 `Monster.csv` (需新建)，根据难度系数调整怪物数值倍率，存入 `global_key['System']['Difficulty']`。
    *   [ ] **位置初始化**：确保 `map.py` 能正确读取角色的 `初期位置` 并放置。

*   **6. 基础地牢战斗 (Dungeon Combat)**
    *   [ ] **战斗循环**：编写一个最简单的回合制战斗事件。读取：`角色地牢数值` vs `怪物数值`。
    *   [ ] **胜负判定**：HP 归零后的处理（返回日常/死亡）。

*   **7. 当日结算系统 (Day End)**
    *   [ ] **基础结算**：编写 `event_end_day`，执行 `DAY += 1`，恢复角色体力/气力。
    *   [ ] **日期推断**：更新日期显示。

---

### 🟡 P2：AI行为与生活模拟 (让世界活起来)

这是你设计中“Pera幻想”的精髓，实现角色自主行动。

*   **8. 角色 AI 机 (Cost System)**
    *   [ ] **行动花销计算器**：编写函数，输入 `角色ID` + `当前时间` + `环境`，输出该角色执行各项行动（移动/对话/打怪）的 Cost 值。
    *   [ ] **决策逻辑**：遍历可选行动，选择 Cost 最小的行为执行。
    *   [ ] **动态修饰**：引入相性、天气对 Cost 的加成（如：讨厌的人在旁边 -> 对话 Cost 暴增）。

*   **9. 睡眠与生理周期**
    *   [ ] **睡眠状态机**：实现 `清醒 -> 困倦(消耗翻倍) -> 强制晕厥` 的状态切换逻辑。
    *   [ ] **起床/就寝判定**：在结算时对比当前时间与角色设定的作息时间。

*   **10. 地牢外社交**
    *   [ ] **组队系统**：增加“邀请”指令，判定 `信赖度/好感度`，成功后将 NPC 加入 `PARTY` 列表，进入地牢时一同传送。

---

### 🔵 P3：内容填充与润色 (锦上添花)

*   **11. 剧情与口上填充**
    *   [ ] **开场剧情**：为不同角色编写差异化的 `Intro` 口上。
    *   [ ] **幻想乡大会**：编写第一个主线任务的剧情脚本，设置任务 Flag。

*   **12. 天气系统**
    *   [ ] **随机天气**：每天结算时 `random` 一个天气，存入全局变量。
    *   [ ] **特殊天气**：给特定地点（如妖怪之山）绑定固定天气逻辑。

*   **13. 地牢内容扩充**
    *   [ ] **地牢商店**：编写随机商店事件。
    *   [ ] **更多房间类型**：完善你在 `DungeonRooms.csv` 里的设计。

---

### 💡 开发建议

1.  **先做“花销数据”的定义**：你的 AI 核心是 Cost，所以先把 Cost 怎么算定下来，不然 AI 没法写。
2.  **先做“简易战斗”**：不要一上来就搞复杂的技能卡牌，先做个 `你打我一下，我打你一下` 的纯数值对撞，跑通流程后再加技能。
3.  **任务驱动开发**：先写好“幻想乡大会”这个任务，然后为了完成这个任务，你需要去写移动、对话、地牢，这样开发目的性更强。